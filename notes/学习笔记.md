<!-- vscode-markdown-toc -->
* 1. [ä»»åŠ¡äºŒï¼šVue-Router åŸç†å®ç°](#Vue-Router)
  * 1.1. [2-1. è¯¾ç¨‹ä»‹ç»](#)
  * 1.2. [2-2. Vue Router åŸºç¡€å›é¡¾-ä½¿ç”¨æ­¥éª¤ï¼ˆ01-vue-router-basic-usageï¼‰](#VueRouter-01-vue-router-basic-usage)
  * 1.3. [2-3 åŠ¨æ€è·¯ç”±ä¼ å‚](#-1)
  * 1.4. [2-4 åµŒå¥—è·¯ç”±](#-1)
  * 1.5. [2-5 ç¼–ç¨‹å¼å¯¼èˆª](#-1)
  * 1.6. [2-6 Hash æ¨¡å¼å’Œ History æ¨¡å¼çš„åŒºåˆ«](#HashHistory)
  * 1.7. [2-7 History æ¨¡å¼](#History)
  * 1.8. [2-8 History æ¨¡å¼ - Node.js](#History-Node.js)
  * 1.9. [2-9 History æ¨¡å¼ - Nginx](#History-Nginx)
  * 1.10. [2-10 VueRouter å®ç°åŸç†ï¼ˆå‚è€ƒï¼š05-history-demoï¼‰](#VueRouter05-history-demo)
  * 1.11. [2-11 VueRouter æ¨¡æ‹Ÿå®ç° - åˆ†æ](#VueRouter-)
  * 1.12. [2-12 VueRouter-install](#VueRouter-install)
  * 1.13. [2-13 VueRouter-æ„é€ å‡½æ•°](#VueRouter--1)
  * 1.14. [2-14 VueRouter-createRouteMap](#VueRouter-createRouteMap)
  * 1.15. [2-15 VueRouter-router-link](#VueRouter-router-link)
  * 1.16. [2-16 VueRouter-å®Œæ•´ç‰ˆçš„vueï¼ˆè§£å†³æ–¹æ¡ˆä¸€ï¼Œä½¿ç”¨å¸¦è¿è¡Œæ—¶ç¼–è¯‘å™¨ç‰ˆæœ¬çš„vueï¼‰](#VueRouter-vuevue)
  * 1.17. [2-17 VueRouter-render](#VueRouter-render)
  * 1.18. [2-18 VueRouter-router-view](#VueRouter-router-view)
  * 1.19. [2-19 VueRouter-initEvent](#VueRouter-initEvent)
  * 1.20. [2-20 VueRouter-å®Œæ•´ä»£ç ](#VueRouter--1)
* 2. [ä»»åŠ¡ä¸‰ï¼šæ¨¡æ‹Ÿvue.jså“åº”å¼åŸç†](#vue.js)
  * 2.1. [3-1 è¯¾ç¨‹ç›®æ ‡](#-1)
  * 2.2. [3-2 æ•°æ®é©±åŠ¨](#-1)
  * 2.3. [3-3 æ•°æ®å“åº”å¼æ ¸å¿ƒåŸç†-Vue 2.x](#Vue2.x)
  * 2.4. [3-4 æ•°æ®å“åº”å¼æ ¸å¿ƒåŸç†-Vue 3](#Vue3)
  * 2.5. [3-5 å‘å¸ƒè®¢é˜…æ¨¡å¼](#-1)
  * 2.6. [3-6 è§‚å¯Ÿè€…æ¨¡å¼](#-1)
  * 2.7. [3-7 æ¨¡æ‹ŸVueå“åº”å¼åŸç† - åˆ†æ](#Vue-)
  * 2.8. [3-8 Vue](#Vue)
  * 2.9. [3-9-10-11 Observer(æ•°æ®åŠ«æŒ)](#Observer)
  * 2.10. [3-12 Compiler](#Compiler)
  * 2.11. [3-13-16 Compilerå¤ä¹ (å‚è€ƒï¼š03-01-03-06-vue-reactivity/minivue)](#Compiler03-01-03-06-vue-reactivityminivue)
  * 2.12. [3-17 Dep(å‘å¸ƒè€…)](#Dep)
  * 2.13. [3-18 Watcher(è§‚å¯Ÿè€…)](#Watcher)
  * 2.14. [3-19-20 åˆ›å»º Watcher å¯¹è±¡](#Watcher-1)
  * 2.15. [3-21 åŒå‘ç»‘å®š](#-1)
  * 2.16. [3-22-23 è°ƒè¯•-é¦–æ¬¡æ¸²æŸ“-æ•°æ®æ”¹å˜](#-1)
  * 2.17. [3-24 æ€»ç»“-é—®é¢˜](#-1)
  * 2.18. [3-25 æ€»ç»“-æ•´ä½“æµç¨‹](#-1)
* 3. [ä»»åŠ¡å››ï¼šVirtual DOM çš„å®ç°åŸç†](#VirtualDOM)
  * 3.1. [4-2 ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM](#DOM)
  * 3.2. [4-3 ä¸ºä»€ä¹ˆä½¿ç”¨è™šæ‹ŸDOM](#DOM-1)
  * 3.3. [4-4 è™šæ‹ŸDOMçš„ä½œç”¨å’Œè™šæ‹ŸDOMåº“](#DOMDOM)
  * 3.4. [4-5 SnabbdomåŸºæœ¬ä½¿ç”¨ - åˆ›å»ºé¡¹ç›®](#Snabbdom-)
  * 3.5. [4-6 å¯¼å…¥ Snabbdom](#Snabbdom)

<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc --># æ‰‹å†™ Vue Routerã€æ‰‹å†™å“åº”å¼å®ç°ã€è™šæ‹Ÿ DOM å’Œ Diff ç®—æ³•

## 1. <a name='Vue-Router'></a>ä»»åŠ¡äºŒï¼šVue-Router åŸç†å®ç°

### 1.1. <a name=''></a>2-1. è¯¾ç¨‹ä»‹ç»

1. Vue Router åŸºç¡€å›é¡¾
2. Hash æ¨¡å¼å’Œ History æ¨¡å¼
3. æ¨¡æ‹Ÿå®ç° Vue Router

### 1.2. <a name='VueRouter-01-vue-router-basic-usage'></a>2-2. Vue Router åŸºç¡€å›é¡¾-ä½¿ç”¨æ­¥éª¤ï¼ˆ01-vue-router-basic-usageï¼‰

1. åˆ›å»ºè·¯ç”±ç›¸å…³ç»„ä»¶
2. æ³¨å†Œè·¯ç”±æ’ä»¶`Vue.use(VueRouter)`
3. åˆ›å»ºRouterå¯¹è±¡ï¼Œé…ç½®è·¯ç”±è§„åˆ™

```js
import Vue from 'vue'
import VueRouter from 'vue-router'
import Index from '../views/Index.vue'
// 1. æ³¨å†Œè·¯ç”±æ’ä»¶
Vue.use(VueRouter)

// è·¯ç”±è§„åˆ™
const routes = [
  {
    path: '/',
    name: 'Index',
    component: Index
  },
  {
    path: '/blog',
    name: 'Blog',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "blog" */ '../views/Blog.vue')
  },
  {
    path: '/photo',
    name: 'Photo',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "photo" */ '../views/Photo.vue')
  }
]
// 2. åˆ›å»º router å¯¹è±¡
const router = new VueRouter({
  routes
})
```

4. æ³¨å†Œ router å¯¹è±¡

```js
// main.js
import Vue from 'vue'
import App from './App.vue'
import router from './router'

Vue.config.productionTip = false

new Vue({
  // 3. æ³¨å†Œ router å¯¹è±¡ï¼Œæ³¨å†ŒåVueå®ä¾‹ä¸­å°±æ³¨å…¥äº†$routeå’Œ$routerå±æ€§
  router,
  render: h => h(App)
}).$mount('#app')

```

### 1.3. <a name='-1'></a>2-3 åŠ¨æ€è·¯ç”±ä¼ å‚

1. é€šè¿‡å ä½ç¬¦çš„æ–¹å¼åœ¨URlä¸­é¢„ç•™å‚æ•°çš„ä½ç½®ï¼Œç»„ä»¶æ¨èä½¿ç”¨æ‡’åŠ è½½æ–¹å¼

```js
import Vue from 'vue'
import VueRouter from 'vue-router'
import Index from '../views/Index.vue'

Vue.use(VueRouter)

const routes = [
  ...
  {
    path: '/detail/:id',
    name: 'Detail',
    // å¼€å¯ propsï¼Œä¼šæŠŠ URL ä¸­çš„å‚æ•°ä¼ é€’ç»™ç»„ä»¶
    // åœ¨ç»„ä»¶ä¸­é€šè¿‡ props æ¥æ¥æ”¶ URL å‚æ•°
    props: true,
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "detail" */ '../views/Detail.vue')
  }
]

const router = new VueRouter({
  routes
})

export default router

```

2. ä¸¤ç§æ–¹å¼æ¥æ”¶å‚æ•°ï¼Œæ¨èä½¿ç”¨ç¬¬äºŒç§ï¼Œç¬¬ä¸€ç§ä¸è·¯ç”±å…·æœ‰å¼ºå…³è”

```js
// Detail.vue
<template>
  <div>
    <!-- æ–¹å¼1ï¼š é€šè¿‡å½“å‰è·¯ç”±è§„åˆ™ï¼Œè·å–æ•°æ® -->
    é€šè¿‡å½“å‰è·¯ç”±è§„åˆ™è·å–ï¼š{{ $route.params.id }}

    <br>
    <!-- æ–¹å¼2ï¼šè·¯ç”±è§„åˆ™ä¸­å¼€å¯ props ä¼ å‚ -->
    é€šè¿‡å¼€å¯ props è·å–ï¼š{{ id }}
  </div>
</template>

<script>
export default {
  name: 'Detail',
  props: ['id']
}
</script>

<style>

</style>

```

### 1.4. <a name='-1'></a>2-4 åµŒå¥—è·¯ç”±

1. å½“æŸäº›é¡µé¢å…±äº«ç›¸åŒçš„å¤´å’Œå°¾éƒ¨æ—¶ï¼Œå¯ç”¨åµŒå¥—è·¯ç”±
2. `Layout.vue`ä¸ºå…±åŒå¸ƒå±€é¡µï¼Œé€šè¿‡`router-view`æ ‡ç­¾æ˜¾ç¤ºå…·ä½“é¡µé¢

```js
<template>
  <div>
    <div>
      <img width="25%" src="@/assets/logo.png">
    </div>
    <div>
      <router-view></router-view>
    </div>
    <div>
      Footer
    </div>
  </div>
</template>

<script>
export default {
  name: 'layout'
}
</script>

<style scoped>
</style>

```

3. è·¯ç”±é…ç½®

```js
import Vue from 'vue'
import VueRouter from 'vue-router'
// åŠ è½½ç»„ä»¶
import Layout from '@/components/Layout.vue'
import Index from '@/views/Index.vue'
import Login from '@/views/Login.vue'

Vue.use(VueRouter)

const routes = [
  {
    name: 'login',// ç™»å½•é¡µæ— éœ€åµŒå¥—
    path: '/login',
    component: Login
  },
  // åµŒå¥—è·¯ç”±
  {
    path: '/',
    component: Layout,// æŒ‡å®šè¢«åµŒå¥—é¡µé¢
    children: [
      {
        name: 'index',
        path: '',
        component: Index
      },
      {
        name: 'detail',
        path: 'detail/:id',
        props: true,
        component: () => import('@/views/Detail.vue')
      }
    ]
  }
]

const router = new VueRouter({
  routes
})

export default router

```

### 1.5. <a name='-1'></a>2-5 ç¼–ç¨‹å¼å¯¼èˆª

1. `replace`ï¼Œæ›¿æ¢å½“å‰è·¯ç”±

```js
this.$router.replace('/login')
```

2. `push`

```js
this.$router.push({ name: 'Detail', params: { id: 1 } })
```

3. `go`ï¼Œè·¯ç”±å›é€€

```js
this.$router.go(-2)
```

### 1.6. <a name='HashHistory'></a>2-6 Hash æ¨¡å¼å’Œ History æ¨¡å¼çš„åŒºåˆ«

1. è¡¨ç°å½¢å¼çš„åŒºåˆ«

* Hashæ¨¡å¼ï¼šæœ‰`#`å·
* Historyæ¨¡å¼ï¼šæ— `#`å·

2. åŸç†çš„åŒºåˆ«

* Hash æ¨¡å¼æ˜¯åŸºäºé”šç‚¹ï¼Œä»¥åŠonhashchangeäº‹ä»¶
* History æ¨¡å¼æ˜¯åŸºäºHTML5ä¸­çš„History API
  * history.pushState() IE10ä»¥åæ‰æ”¯æŒ
  * history.replaceState()

### 1.7. <a name='History'></a>2-7 History æ¨¡å¼

1. History éœ€è¦æœåŠ¡å™¨çš„æ”¯æŒ
2. å•é¡µåº”ç”¨ä¸­ï¼ŒæœåŠ¡ç«¯ä¸å­˜åœ¨[http://www.testurl.com/login]()è¿™æ ·çš„åœ°å€ï¼Œä¼šè¿”å›æ‰¾ä¸åˆ°è¯¥é¡µé¢
3. åœ¨æœåŠ¡ç«¯åº”è¯¥é™¤äº†é™æ€èµ„æºå¤–éƒ½è¿”å›å•é¡µåº”ç”¨çš„index.html

```js
import Vue from 'vue'
import VueRouter from 'vue-router'
import Home from '../views/Home.vue'

Vue.use(VueRouter)

const routes = [
  {
    path: '/',
    name: 'Home',
    component: Home
  },
  {
    path: '/about',
    name: 'About',
    component: () => import(/* webpackChunkName: "about" */ '../views/About.vue')
  },
  {
    path: '*',// æœªåŒ¹é…çš„è·¯ç”±è·³è½¬è‡³404é¡µé¢
    name: '404',
    component: () => import(/* webpackChunkName: "404" */ '../views/404.vue')
  }
]

const router = new VueRouter({
  mode: 'history',// é»˜è®¤ä¸ºhashæ¨¡å¼
  routes
})

export default router

```

### 1.8. <a name='History-Node.js'></a>2-8 History æ¨¡å¼ - Node.js

```js
// app.js
const path = require('path')
// å¯¼å…¥å¤„ç† history æ¨¡å¼çš„æ¨¡å—
const history = require('connect-history-api-fallback')
// å¯¼å…¥ express
const express = require('express')

const app = express()
// æ³¨å†Œå¤„ç† history æ¨¡å¼çš„ä¸­é—´ä»¶
app.use(history())
// å¤„ç†é™æ€èµ„æºçš„ä¸­é—´ä»¶ï¼Œç½‘ç«™æ ¹ç›®å½• ../web
app.use(express.static(path.join(__dirname, '../web')))

// å¼€å¯æœåŠ¡å™¨ï¼Œç«¯å£æ˜¯ 3000
app.listen(3000, () => {
  console.log('æœåŠ¡å™¨å¼€å¯ï¼Œç«¯å£ï¼š3000')
})

```

### 1.9. <a name='History-Nginx'></a>2-9 History æ¨¡å¼ - Nginx

1. ä¿®æ”¹`nginx.conf`æ–‡ä»¶

```json
location / {
  root html;
  index index.html index.htm;
  try_files $uri $uri/ /index.html;// Historyæ¨¡å¼é…ç½®
}
```

### 1.10. <a name='VueRouter05-history-demo'></a>2-10 VueRouter å®ç°åŸç†ï¼ˆå‚è€ƒï¼š05-history-demoï¼‰

1. Hash æ¨¡å¼ï¼š
   1. URL ä¸­`#`åé¢çš„å†…å®¹ä½œä¸ºè·¯å¾„åœ°å€
   2. ç›‘å¬ hashchange äº‹ä»¶
   3. æ ¹æ®å½“å‰è·¯ç”±åœ°å€æ‰¾åˆ°å¯¹åº”ç»„ä»¶é‡æ–°æ¸²æŸ“

2. History æ¨¡å¼ï¼š
   1. é€šè¿‡history.pushState()æ–¹æ³•æ”¹å˜åœ°å€æ 
   2. ç›‘å¬ popstate äº‹ä»¶
   3. æ ¹æ®å½“å‰è·¯ç”±åœ°å€æ‰¾åˆ°å¯¹åº”ç»„ä»¶é‡æ–°æ¸²æŸ“

### 1.11. <a name='VueRouter-'></a>2-11 VueRouter æ¨¡æ‹Ÿå®ç° - åˆ†æ

1. æ ¸å¿ƒä»£ç 

```js
// æ³¨å†Œæ’ä»¶
Vue.use(VueRouter)

const routes = [
  {
    path: '/',
    name: 'Home',
    component: Home
  }
]
// åˆ›å»ºè·¯ç”±å¯¹è±¡
const router = new VueRouter({
  routes
})
// main.js
// åˆ›å»ºvueå®ä¾‹ï¼Œæ³¨å†Œ router å¯¹è±¡
new Vue({
  router,
  render: h => h(App)
}).$mount('#app')

```

2. `Vue.use`æ–¹æ³•å¯ä¼ å…¥å‡½æ•°æˆ–å¯¹è±¡

* ä¼ å…¥å‡½æ•°åˆ™å†…éƒ¨ä¼šç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°
* ä¼ å…¥å¯¹è±¡ä¼šè°ƒç”¨å¯¹è±¡çš„`install`æ–¹æ³•

3. ç±»å›¾

|VueRouter|
| ---- |
|<b>å±æ€§</b><br>+ options<br>+ data<br>+ routeMap |
|<b>æ–¹æ³•</b><br>+ Constructor(Options): VueRouter<br>_install(Vue): void<br>+ init(): void<br>+ initEvent(): void<br>+ createRouteMap(): void<br>+ initComponents(Vue): void |

### 1.12. <a name='VueRouter-install'></a>2-12 VueRouter-install

1. å®ç°`install`æ–¹æ³•

```js
class VueRouter {
  static install(Vue){
    //1 åˆ¤æ–­å½“å‰æ’ä»¶æ˜¯å¦è¢«å®‰è£…
    if(VueRouter.install.installed){
        return;
    }
    VueRouter.install.installed = true
    //2 æŠŠVueçš„æ„é€ å‡½æ•°è®°å½•åœ¨å…¨å±€
    _Vue = Vue
    //3 æŠŠåˆ›å»ºVueçš„å®ä¾‹ä¼ å…¥çš„routerå¯¹è±¡æ³¨å…¥åˆ°Vueå®ä¾‹
    // _Vue.prototype.$router = this.$options.router
    _Vue.mixin({
        beforeCreate(){
            if(this.$options.router){
                _Vue.prototype.$router = this.$options.router
                
            }
            
        }
    })
  }
}
```

### 1.13. <a name='VueRouter--1'></a>2-13 VueRouter-æ„é€ å‡½æ•°

1. å®ç°æ„é€ å‡½æ•°

```js
class VueRouter {
  static install(Vue){
    ...
  }
  constructor(options){
      this.options = options
      this.routeMap = {}
      // observable
      this.data = _Vue.observable({
          current:"/"
      })
      this.init()

  }
}
```

### 1.14. <a name='VueRouter-createRouteMap'></a>2-14 VueRouter-createRouteMap

1. éå†æ‰€æœ‰çš„è·¯ç”±è§„åˆ™ æŠŠè·¯ç”±è§„åˆ™è§£ææˆé”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨åˆ°routeMapä¸­

```js
class VueRouter {
  static install(Vue){
    ...
  }
  constructor(options){
    ...
  }
  createRouteMap(){
    //éå†æ‰€æœ‰çš„è·¯ç”±è§„åˆ™ æŠŠè·¯ç”±è§„åˆ™è§£ææˆé”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨åˆ°routeMapä¸­
    this.options.routes.forEach(route => {
        this.routeMap[route.path] = route.component
    });
  }
}
```

### 1.15. <a name='VueRouter-router-link'></a>2-15 VueRouter-router-link

1. Vueçš„æ„å»ºç‰ˆæœ¬

* è¿è¡Œæ—¶ç‰ˆï¼šä¸æ”¯æŒtemplateæ¨¡æ¿ï¼Œéœ€è¦æ‰“åŒ…çš„æ—¶å€™æå‰ç¼–è¯‘
* å®Œæ•´ç‰ˆï¼šåŒ…å«è¿è¡Œæ—¶å’Œç¼–è¯‘å™¨ï¼Œä½“ç§¯æ¯”è¿è¡Œæ—¶ç‰ˆå¤§10kå·¦å³ï¼Œç¨‹åºè¿è¡Œçš„æ—¶å€™æŠŠæ¨¡æ¿è½¬æ¢æˆ**render**å‡½æ•°

2. æ­¤å¤„ä»£ç ä¸å®Œæ•´ï¼Œå®Œæ•´ä»£ç ä¸‹é¢ğŸ‘‡è´´å‡º

```js
class VueRouter {
  static install(Vue){
    ...
    _Vue.mixin({
      beforeCreate(){
        if(this.$options.router){
          _Vue.prototype.$router = this.$options.router
          this.init()
        }  
      }
    })
  }
  constructor(options){
    ...
  }
  createRouteMap(){
   ...
  }
  init(){
    this.createRouteMap()
    this.initComponent(_Vue)
  }
  initComponent(Vue){
    Vue.component("router-link",{
        props:{
            to:String
        },
        template:"<a :href='to'><slot></slot><>"
    })
  }
}
```

### 1.16. <a name='VueRouter-vuevue'></a>2-16 VueRouter-å®Œæ•´ç‰ˆçš„vueï¼ˆè§£å†³æ–¹æ¡ˆä¸€ï¼Œä½¿ç”¨å¸¦è¿è¡Œæ—¶ç¼–è¯‘å™¨ç‰ˆæœ¬çš„vueï¼‰

1. åŠ è½½å¸¦ç¼–è¯‘å™¨ç‰ˆæœ¬çš„Vue

```js
// vue.config.js
module.exports = {
  runtimeCompiler: true
}
```

### 1.17. <a name='VueRouter-render'></a>2-17 VueRouter-render

1. è‡ªå·±å®ç°`render`å‡½æ•°ï¼Œä¸ä½¿ç”¨`template`

```js
class VueRouter {
  static install(Vue){
    ..
  }
  constructor(options){
    ...
  }
  createRouteMap(){
   ...
  }
  init(){
    ...
  }
  initComponent(Vue){
    Vue.component("router-link",{
        props:{
            to:String
        },
        render(h){
          return h("a",{
            attrs:{
              href:this.to
            }
          },[this.$slots.default])// è·å–æ’æ§½å†…å®¹
        }
        // template:"<a :href='to'><slot></slot><>"
    })
  }
}
```

### 1.18. <a name='VueRouter-router-view'></a>2-18 VueRouter-router-view

1. æ³¨å†Œ`router-view`ç»„ä»¶ï¼Œé€šè¿‡`render`å‡½æ•°æŠŠç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢

```js
const self = this
Vue.component("router-view",{
  render(h){
    // self.data.current
    const cm=self.routeMap[self.data.current]
    return h(cm)
  }
})
```

2. ä¿®æ”¹`router-link`çš„ç‚¹å‡»äº‹ä»¶

* ä¿®æ”¹åœ°å€æ ä¸­åœ°å€
* ä¿®æ”¹`current`å€¼
* ä¸å‘æµè§ˆå™¨å‘é€è¯·æ±‚

```js
Vue.component("router-link",{
    props:{
        to:String
    },
    render(h){
        return h("a",{
            attrs:{
                href:this.to
            },
            on:{
                click:this.clickhander
            }
        },[this.$slots.default])
    },
    methods:{
        clickhander(e){
            history.pushState({},"",this.to)
            this.$router.data.current=this.to
            e.preventDefault()
        }
    }
    // template:"<a :href='to'><slot></slot><>"
})
```

### 1.19. <a name='VueRouter-initEvent'></a>2-19 VueRouter-initEvent

1. ç›‘å¬æµè§ˆå™¨`popstate`äº‹ä»¶

```js
initEvent(){
  window.addEventListener("popstate",()=>{
    this.data.current = window.location.pathname
  })
}
```

### 1.20. <a name='VueRouter--1'></a>2-20 VueRouter-å®Œæ•´ä»£ç 

```js
console.dir(Vue)
let _Vue = null
class VueRouter {
  static install(Vue){
    //1 åˆ¤æ–­å½“å‰æ’ä»¶æ˜¯å¦è¢«å®‰è£…
    if(VueRouter.install.installed){
      return;
    }
    VueRouter.install.installed = true
    //2 æŠŠVueçš„æ„é€ å‡½æ•°è®°å½•åœ¨å…¨å±€
    _Vue = Vue
    //3 æŠŠåˆ›å»ºVueçš„å®ä¾‹ä¼ å…¥çš„routerå¯¹è±¡æ³¨å…¥åˆ°Vueå®ä¾‹
    // _Vue.prototype.$router = this.$options.router
    _Vue.mixin({
      beforeCreate(){
        if(this.$options.router){
          _Vue.prototype.$router = this.$options.router
            
        }  
      }
    })
  }
  constructor(options){
    this.options = options
    this.routeMap = {}
    // observable
    this.data = _Vue.observable({
      current:"/"
    })
    this.init()
  }
  init(){
    this.createRouteMap()
    this.initComponent(_Vue)
    this.initEvent()
  }
  createRouteMap(){
    //éå†æ‰€æœ‰çš„è·¯ç”±è§„åˆ™ æŠŠè·¯ç”±è§„åˆ™è§£ææˆé”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨åˆ°routeMapä¸­
    this.options.routes.forEach(route => {
      this.routeMap[route.path] = route.component
    });
  }
  initComponent(Vue){
    Vue.component("router-link",{
      props:{
        to:String
      },
      render(h){
        return h("a",{
          attrs:{
            href:this.to
          },
          on:{
            click:this.clickhander
          }
        },[this.$slots.default])          
      },
      methods:{
        clickhander(e){
          history.pushState({},"",this.to)
          this.$router.data.current=this.to
          e.preventDefault()
        }
      }
      // template:"<a :href='to'><slot></slot><>"
    })
    const self = this
    Vue.component("router-view",{
      render(h){
        // self.data.current
        const cm=self.routeMap[self.data.current]
        return h(cm)
      }
    })
      
  }
  initEvent(){
    //
    window.addEventListener("popstate",()=>{
      this.data.current = window.location.pathname
    })
  }
}
```

## 2. <a name='vue.js'></a>ä»»åŠ¡ä¸‰ï¼šæ¨¡æ‹Ÿvue.jså“åº”å¼åŸç†

### 2.1. <a name='-1'></a>3-1 è¯¾ç¨‹ç›®æ ‡

1. æ¨¡ä¸€ä¸ªæœ€å°ç‰ˆæœ¬çš„vue
2. å“åº”å¼åŸç†åœ¨é¢è¯•æ—¶çš„å¸¸é—®é—®é¢˜
3. å­¦ä¹ åˆ«äººçš„ä¼˜ç§€ç»éªŒï¼Œè½¬æ¢æˆè‡ªå·±çš„ç»éªŒ
4. å®é™…é¡¹ç›®ä¸­å‡ºçš„é—®é¢˜çš„åŸç†å±‚é¢çš„ç»“å±€
   1. ç»™vueå®ä¾‹æ–°å¢ä¸€ä¸ªæˆå‘˜æ˜¯å¦æ˜¯å“åº”å¼çš„ï¼Ÿ
   2. ç»™å±æ€§é‡æ–°èµ‹å€¼æˆå¯¹è±¡ï¼Œæ˜¯å¦æ˜¯å“åº”å¼çš„ï¼Ÿ
5. ä¸ºå­¦ä¹ vueæºç åšé“ºå«

### 2.2. <a name='-1'></a>3-2 æ•°æ®é©±åŠ¨

1. æ•°æ®å“åº”å¼
   1. æ•°æ®æ¨¡å‹ä»…ä»…æ˜¯æ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œè€Œå½“æˆ‘ä»¬ä¿®æ”¹æ•°æ®æ—¶ï¼Œè¯•å›¾ä¼šè¿›è¡Œæ›´æ–°ï¼Œé¿å…äº†ç¹ççš„ Dom æ“ä½œï¼Œæé«˜å¼€å‘æ•ˆç‡
2. åŒå‘ç»‘å®š
   1. æ•°æ®æ”¹å˜åˆ™è§†å›¾æ”¹å˜ï¼›è¯•å›¾æ”¹å˜ï¼Œæ•°æ®ä¹Ÿéšä¹‹æ”¹å˜
   2. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ v-model åœ¨è¡¨å•å…ƒç´ ä¸Šåˆ›å»ºåŒå‘æ•°æ®ç»‘å®š
3. æ•°æ®é©±åŠ¨æ˜¯ Vue æœ€ç‹¬ç‰¹çš„ç‰¹æ€§ä¹‹ä¸€
   1. å¼€å‘è¿‡ç¨‹ä¸­ä»…ä»…éœ€è¦å…³æ³¨æ•°æ®æœ¬èº«ï¼Œä¸éœ€è¦å…³å¿ƒæ•°æ®æ˜¯å¦‚ä½•æ¸²æŸ“åˆ° Dom çš„

### 2.3. <a name='Vue2.x'></a>3-3 æ•°æ®å“åº”å¼æ ¸å¿ƒåŸç†-Vue 2.x

1. åˆ©ç”¨`Object.defineProperty`æ¥å®ç°

```js
// æ¨¡æ‹Ÿ Vue ä¸­çš„ data é€‰é¡¹
let data = {
  msg: 'hello',
  count: 10
}

// æ¨¡æ‹Ÿ Vue çš„å®ä¾‹
let vm = {}

proxyData(data)

function proxyData(data) {
  // éå† data å¯¹è±¡çš„æ‰€æœ‰å±æ€§
  Object.keys(data).forEach(key => {
    // æŠŠ data ä¸­çš„å±æ€§ï¼Œè½¬æ¢æˆ vm çš„ setter/setter
    Object.defineProperty(vm, key, {
      enumerable: true,
      configurable: true,
      get () {
        console.log('get: ', key, data[key])
        return data[key]
      },
      set (newValue) {
        console.log('set: ', key, newValue)
        if (newValue === data[key]) {
          return
        }
        data[key] = newValue
        // æ•°æ®æ›´æ”¹ï¼Œæ›´æ–° DOM çš„å€¼
        document.querySelector('#app').textContent = data[key]
      }
    })
  })
}

// æµ‹è¯•
vm.msg = 'Hello World'
console.log(vm.msg)
```

### 2.4. <a name='Vue3'></a>3-4 æ•°æ®å“åº”å¼æ ¸å¿ƒåŸç†-Vue 3

1. åˆ©ç”¨`Proxy`å®ç°ï¼Œç›´æ¥ç›‘å¬å¯¹è±¡ï¼Œè€Œéå±æ€§
2. ES6ä¸­æ–°å¢ï¼ŒIE ä¸æ”¯æŒï¼Œæ€§èƒ½ç”±æµè§ˆå™¨ä¼˜åŒ–

```js
// æ¨¡æ‹Ÿ Vue ä¸­çš„ data é€‰é¡¹
let data = {
  msg: 'hello',
  count: 0
}

// æ¨¡æ‹Ÿ Vue å®ä¾‹
let vm = new Proxy(data, {
  // æ‰§è¡Œä»£ç†è¡Œä¸ºçš„å‡½æ•°
  // å½“è®¿é—® vm çš„æˆå‘˜ä¼šæ‰§è¡Œ
  get (target, key) {
    console.log('get, key: ', key, target[key])
    return target[key]
  },
  // å½“è®¾ç½® vm çš„æˆå‘˜ä¼šæ‰§è¡Œ
  set (target, key, newValue) {
    console.log('set, key: ', key, newValue)
    if (target[key] === newValue) {
      return
    }
    target[key] = newValue
    document.querySelector('#app').textContent = target[key]
  }
})

// æµ‹è¯•
vm.msg = 'Hello World'
console.log(vm.msg)
```

### 2.5. <a name='-1'></a>3-5 å‘å¸ƒè®¢é˜…æ¨¡å¼

1. å®ç°ä¸€ä¸ª`äº‹ä»¶è§¦å‘å™¨`çš„ç±»ï¼Œç±»ä¸­å®ç°`æ³¨å†Œäº‹ä»¶`å’Œ`è§¦å‘äº‹ä»¶`ä¸¤ä¸ªæ–¹æ³•

```js
// äº‹ä»¶è§¦å‘å™¨
class EventEmitter {
  constructor () {
    // { 'click': [fn1, fn2], 'change': [fn] }
    this.subs = Object.create(null)
  }

  // æ³¨å†Œäº‹ä»¶
  $on (eventType, handler) {
    this.subs[eventType] = this.subs[eventType] || []
    this.subs[eventType].push(handler)
  }

  // è§¦å‘äº‹ä»¶
  $emit (eventType) {
    if (this.subs[eventType]) {
      this.subs[eventType].forEach(handler => {
        handler()
      })
    }
  }
}

// æµ‹è¯•
let em = new EventEmitter()
em.$on('click', () => {
  console.log('click1')
})
em.$on('click', () => {
  console.log('click2')
})

em.$emit('click')
```

### 2.6. <a name='-1'></a>3-6 è§‚å¯Ÿè€…æ¨¡å¼

1. è§‚å¯Ÿè€…(è®¢é˜…è€…)ï¼šWatcher
   1. update()ï¼šå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå…·ä½“è¦åšçš„äº‹æƒ…
2. ç›®æ ‡(å‘å¸ƒè€…)ï¼šDep
   1. subsæ•°ç»„ï¼šå­˜å‚¨æ‰€æœ‰çš„è§‚å¯Ÿè€…
   2. addSub()ï¼šæ·»åŠ è§‚å¯Ÿè€…
   3. notify()ï¼šå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè°ƒç”¨æ‰€æœ‰è§‚å¯Ÿè€…çš„ update()æ–¹æ³•
3. æ²¡æœ‰äº‹ä»¶ä¸­å¿ƒ
4. `è§‚å¯Ÿè€…æ¨¡å¼`å’Œ`å‘å¸ƒè®¢é˜…æ¨¡å¼`çš„åŒºåˆ«
   1. **è§‚å¯Ÿè€…æ¨¡å¼**æ˜¯ç”±å…·ä½“ç›®æ ‡è°ƒåº¦ï¼Œæ¯”å¦‚å½“äº‹ä»¶è§¦å‘ï¼ŒDep å°±ä¼šå»è°ƒç”¨è§‚å¯Ÿè€…çš„æ–¹æ³•ï¼Œæ‰€æœ‰è¯¥æ¨¡å¼çš„è®¢é˜…è€…ä¸å‘å¸ƒè€…ä¹‹é—´æ˜¯å­˜åœ¨ä¾èµ–çš„
   2. **å‘å¸ƒ/è®¢é˜…æ¨¡å¼**ç”±ç»Ÿä¸€è°ƒåº¦ä¸­å¿ƒè°ƒç”¨ï¼Œå‘å¸ƒè€…å‘å¸ƒåˆ°`äº‹ä»¶ä¸­å¿ƒ`ï¼Œè®¢é˜…è€…è®¢é˜…`äº‹ä»¶ä¸­å¿ƒ`ï¼Œå¹¶ç”±`äº‹ä»¶ä¸­å¿ƒ`è§¦å‘è®¢é˜…è€…ã€‚å› æ­¤å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¸éœ€è¦çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨

```js
// å‘å¸ƒè€…-ç›®æ ‡
    class Dep {
      constructor () {
        // è®°å½•æ‰€æœ‰çš„è®¢é˜…è€…
        this.subs = []
      }
      // æ·»åŠ è®¢é˜…è€…
      addSub (sub) {
        if (sub && sub.update) {
          this.subs.push(sub)
        }
      }
      // å‘å¸ƒé€šçŸ¥
      notify () {
        this.subs.forEach(sub => {
          sub.update()
        })
      }
    }
    // è®¢é˜…è€…-è§‚å¯Ÿè€…
    class Watcher {
      update () {
        console.log('update')
      }
    }

    // æµ‹è¯•
    let dep = new Dep()
    let watcher = new Watcher()
    // å°†è§‚å¯Ÿè€…æ·»åŠ åˆ°å‘å¸ƒè€…ä¸­ï¼Œç­‰å¾…å‘å¸ƒè€…çš„è§¦å‘
    dep.addSub(watcher)

    dep.notify()
```

### 2.7. <a name='Vue-'></a>3-7 æ¨¡æ‹ŸVueå“åº”å¼åŸç† - åˆ†æ

1. ![vueå“åº”å¼åŸç†](https://github.com/ALLTAKENS/MarkDownImg/blob/master/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.png?raw=true)

### 2.8. <a name='Vue'></a>3-8 Vue

```js
class Vue {
  constructor (options) {
    // 1. é€šè¿‡å±æ€§ä¿å­˜é€‰é¡¹çš„æ•°æ®
    this.$options = options || {}
    this.$data = options.data || {}
    this.$el = typeof options.el === 'string' ? document.querySelector(options.el) : options.el
    // 2. æŠŠdataä¸­çš„æˆå‘˜è½¬æ¢æˆgetterå’Œsetterï¼Œæ³¨å…¥åˆ°vueå®ä¾‹ä¸­
    this._proxyData(this.$data)
    // 3. è°ƒç”¨observerå¯¹è±¡ï¼Œç›‘å¬æ•°æ®çš„å˜åŒ–
    // 4. è°ƒç”¨compilerå¯¹è±¡ï¼Œè§£ææŒ‡ä»¤å’Œå·®å€¼è¡¨è¾¾å¼
  }
  _proxyData (data) {
    // éå†dataä¸­çš„æ‰€æœ‰å±æ€§
    Object.keys(data).forEach(key => {
      // æŠŠdataçš„å±æ€§æ³¨å…¥åˆ°vueå®ä¾‹ä¸­
      Object.defineProperty(this, key, {
        enumerable: true,
        configurable: true,
        get () {
          return data[key]
        },
        set (newValue) {
          if (newValue === data[key]) {
            return
          }
          data[key] = newValue
        }
      })
    })
  }
}
```

### 2.9. <a name='Observer'></a>3-9-10-11 Observer(æ•°æ®åŠ«æŒ)

1. åŠŸèƒ½
   1. å¤åˆå§dataé€‰é¡¹ä¸­çš„å±æ€§è½¬æ¢æˆå“åº”å¼æ•°æ®
   2. data ä¸­çš„æŸä¸ªå±æ€§ä¹Ÿæ˜¯å¯¹è±¡ï¼ŒæŠŠè¯¥å±æ€§ä¹Ÿè½¬æ¢æˆå“åº”å¼æ•°æ®
   3. æ•°æ®å˜åŒ–å‘é€é€šçŸ¥
2. ç»“æ„

  |Observer|
  | ---- |
  | + walk(data) |
  | + defineReactive(data, key, value) |

```js
class Observer {
  constructor (data) {
    this.walk(data)
  }
  walk (data) {
    // 1. åˆ¤æ–­dataæ˜¯å¦æ˜¯å¯¹è±¡
    if (!data || typeof data !== 'object') {
      return
    }
    // 2. éå†dataå¯¹è±¡çš„æ‰€æœ‰å±æ€§
    Object.keys(data).forEach(key => {
      this.defineReactive(data, key, data[key])
    })
  }
  defineReactive (obj, key, val) {
    let that = this
    // è´Ÿè´£æ”¶é›†ä¾èµ–ï¼Œå¹¶å‘é€é€šçŸ¥
    let dep = new Dep()
    // å¦‚æœvalæ˜¯å¯¹è±¡ï¼ŒæŠŠvalå†…éƒ¨çš„å±æ€§è½¬æ¢æˆå“åº”å¼æ•°æ®
    this.walk(val)
    Object.defineProperty(obj, key, {
      enumerable: true,
      configurable: true,
      get () {
        // æ”¶é›†ä¾èµ–
        Dep.target && dep.addSub(Dep.target)
        return val
      },
      set (newValue) {
        if (newValue === val) {
          return
        }
        val = newValue
        that.walk(newValue)
        // å‘é€é€šçŸ¥
        dep.notify()
      }
    })
  }
}
```

### 2.10. <a name='Compiler'></a>3-12 Compiler

1. åŠŸèƒ½
    1. è´Ÿè´£ç¼–è¯‘æ¨¡æ¿ï¼Œè§£ææŒ‡ä»¤/æ’å€¼è¡¨è¾¾å¼
    2. è´Ÿè´£é¡µé¢çš„é¦–æ¬¡æ¸²æŸ“
    3. å½“æ•°æ®å˜åŒ–åé‡æ–°æ¸²æŸ“è§†å›¾

2. ç»“æ„

|Compiler|
| ---- |
| + el<br>+ vm |
| + compile(el)<br>+ compileElement(node)<br>+ compileText(node)<br>+ isDirective(attrName)<br>+ isTextNode(node)<br>+ isElementNode(node) |

### 2.11. <a name='Compiler03-01-03-06-vue-reactivityminivue'></a>3-13-16 Compilerå¤ä¹ (å‚è€ƒï¼š03-01-03-06-vue-reactivity/minivue)

```js
class Compiler {
  constructor (vm) {
    this.el = vm.$el
    this.vm = vm
    this.compile(this.el)
  }
  // ç¼–è¯‘æ¨¡æ¿ï¼Œå¤„ç†æ–‡æœ¬èŠ‚ç‚¹å’Œå…ƒç´ èŠ‚ç‚¹
  compile (el) {
    let childNodes = el.childNodes
    Array.from(childNodes).forEach(node => {
      // å¤„ç†æ–‡æœ¬èŠ‚ç‚¹
      if (this.isTextNode(node)) {
        this.compileText(node)
      } else if (this.isElementNode(node)) {
        // å¤„ç†å…ƒç´ èŠ‚ç‚¹
        this.compileElement(node)
      }

      // åˆ¤æ–­nodeèŠ‚ç‚¹ï¼Œæ˜¯å¦æœ‰å­èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œè¦é€’å½’è°ƒç”¨compile
      if (node.childNodes && node.childNodes.length) {
        this.compile(node)
      }
    })
  }
  // ç¼–è¯‘å…ƒç´ èŠ‚ç‚¹ï¼Œå¤„ç†æŒ‡ä»¤
  compileElement (node) {
    // console.log(node.attributes)
    // éå†æ‰€æœ‰çš„å±æ€§èŠ‚ç‚¹
    Array.from(node.attributes).forEach(attr => {
      // åˆ¤æ–­æ˜¯å¦æ˜¯æŒ‡ä»¤
      let attrName = attr.name
      if (this.isDirective(attrName)) {
        // v-text --> text
        attrName = attrName.substr(2)
        let key = attr.value
        this.update(node, key, attrName)
      }
    })
  }

  update (node, key, attrName) {
    let updateFn = this[attrName + 'Updater']
    updateFn && updateFn.call(this, node, this.vm[key], key)
  }

  // å¤„ç† v-text æŒ‡ä»¤
  textUpdater (node, value, key) {
    node.textContent = value
    new Watcher(this.vm, key, (newValue) => {
      node.textContent = newValue
    })
  }
  // v-model
  modelUpdater (node, value, key) {
    node.value = value
    new Watcher(this.vm, key, (newValue) => {
      node.value = newValue
    })
    // åŒå‘ç»‘å®š
    node.addEventListener('input', () => {
      this.vm[key] = node.value
    })
  }

  // ç¼–è¯‘æ–‡æœ¬èŠ‚ç‚¹ï¼Œå¤„ç†å·®å€¼è¡¨è¾¾å¼
  compileText (node) {
    // console.dir(node)
    // {{  msg }}
    let reg = /\{\{(.+?)\}\}/
    let value = node.textContent
    if (reg.test(value)) {
      let key = RegExp.$1.trim()
      node.textContent = value.replace(reg, this.vm[key])

      // åˆ›å»ºwatcherå¯¹è±¡ï¼Œå½“æ•°æ®æ”¹å˜æ›´æ–°è§†å›¾
      new Watcher(this.vm, key, (newValue) => {
        node.textContent = newValue
      })
    }
  }
  // åˆ¤æ–­å…ƒç´ å±æ€§æ˜¯å¦æ˜¯æŒ‡ä»¤
  isDirective (attrName) {
    return attrName.startsWith('v-')
  }
  // åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹
  isTextNode (node) {
    return node.nodeType === 3
  }
  // åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ˜¯å…ƒç´ èŠ‚ç‚¹
  isElementNode (node) {
    return node.nodeType === 1
  }
}
```

### 2.12. <a name='Dep'></a>3-17 Dep(å‘å¸ƒè€…)

1. ä½œç”¨ï¼šæ”¶é›†ä¾èµ–ï¼›é€šçŸ¥ä¾èµ–
1. è§£æ„

|Dep|
| ---- |
| + subs |
| + addSub(sub)<br> + notify() |

```js
class Dep {
  constructor () {
    // å­˜å‚¨æ‰€æœ‰çš„è§‚å¯Ÿè€…
    this.subs = []
  }
  // æ·»åŠ è§‚å¯Ÿè€…
  addSub (sub) {
    if (sub && sub.update) {
      this.subs.push(sub)
    }
  }
  // å‘é€é€šçŸ¥
  notify () {
    this.subs.forEach(sub => {
      sub.update()
    })
  }
}
```

### 2.13. <a name='Watcher'></a>3-18 Watcher(è§‚å¯Ÿè€…)

1. ç»“æ„

| Watcher |
| ---- |
| + vm<br> + key<br> + cb<br> + oldValue<br>|
| + update() |

```js
class Watcher {
  constructor (vm, key, cb) {
    this.vm = vm
    // dataä¸­çš„å±æ€§åç§°
    this.key = key
    // å›è°ƒå‡½æ•°è´Ÿè´£æ›´æ–°è§†å›¾
    this.cb = cb

    // æŠŠwatcherå¯¹è±¡è®°å½•åˆ°Depç±»çš„é™æ€å±æ€§target
    Dep.target = this
    // è§¦å‘getæ–¹æ³•ï¼Œåœ¨getæ–¹æ³•ä¸­ä¼šè°ƒç”¨addSub
    this.oldValue = vm[key]
    Dep.target = null
  }
  // å½“æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ›´æ–°è§†å›¾
  update () {
    let newValue = this.vm[this.key]
    if (this.oldValue === newValue) {
      return
    }
    this.cb(newValue)
  }
}
```

### 2.14. <a name='Watcher-1'></a>3-19-20 åˆ›å»º Watcher å¯¹è±¡

1. åœ¨`textUpdater`ã€`modelUpdater`ã€`compileText(å¤„ç†æ’å€¼è¡¨è¾¾å¼)`ä¸‰ä¸ªæ–¹æ³•ä¸­åˆ›å»º`Watcher`å¯¹è±¡ï¼Œå½“æ•°æ®æ”¹å˜æ›´æ–°è§†å›¾

### 2.15. <a name='-1'></a>3-21 åŒå‘ç»‘å®š

1. ç›‘å¬`input`äº‹ä»¶

```js
// v-model
modelUpdater (node, value, key) {
  node.value = value
  new Watcher(this.vm, key, (newValue) => {
    node.value = newValue
  })
  // åŒå‘ç»‘å®š
  node.addEventListener('input', () => {
    this.vm[key] = node.value
  })
}
```

### 2.16. <a name='-1'></a>3-22-23 è°ƒè¯•-é¦–æ¬¡æ¸²æŸ“-æ•°æ®æ”¹å˜

1. è‡ªå·±è°ƒè¯•å‡ é

### 2.17. <a name='-1'></a>3-24 æ€»ç»“-é—®é¢˜

1. é—®é¢˜
   1. ç»™å±æ€§é‡æ–°èµ‹å€¼æˆå¯¹è±¡ï¼Œæ˜¯å¦æ˜¯å“åº”å¼çš„ï¼Ÿæ˜¯çš„
   2. ç»™ Vue å®ä¾‹æ–°å¢ä¸€ä¸ªæˆå‘˜æ˜¯å¦æ˜¯å“åº”å¼çš„ï¼Ÿ
      1. ä¸æ˜¯ï¼Œå¯é€šè¿‡`Vue.set`æ–¹æ³•æ·»åŠ å±æ€§

### 2.18. <a name='-1'></a>3-25 æ€»ç»“-æ•´ä½“æµç¨‹

1. é€šè¿‡ä¸‹å›¾å›é¡¾æ•´ä½“æµç¨‹
![vueå“åº”å¼å®Œæ•´æµç¨‹](https://github.com/ALLTAKENS/MarkDownImg/blob/master/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B.jpeg?raw=true)

## 3. <a name='VirtualDOM'></a>ä»»åŠ¡å››ï¼šVirtual DOM çš„å®ç°åŸç†

### 3.1. <a name='DOM'></a>4-2 ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM

1. ç”±æ™®é€šçš„ JS å¯¹è±¡æ¥æè¿° DOM å¯¹è±¡ï¼Œå› ä¸ºä¸æ˜¯çœŸå®çš„ DOM å¯¹è±¡ï¼Œæ‰€ä»¥å« Virtual Dom

### 3.2. <a name='DOM-1'></a>4-3 ä¸ºä»€ä¹ˆä½¿ç”¨è™šæ‹ŸDOM

1. æ‰‹åŠ¨æ“ä½œ DOM æ¯”è¾ƒéº»çƒ¦ï¼Œè¿˜éœ€è¦è€ƒè™‘æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ï¼Œè™½ç„¶æœ‰ jQuery ç­‰åº“ç®€åŒ– DOM æ“ä½œï¼Œä½†æ˜¯éšç€é¡¹ç›®çš„å¤æ‚ DOM æ“ä½œå¤æ‚æå‡
2. ä¸ºäº†ç®€åŒ– DOM çš„å¤æ‚æ“ä½œäºæ˜¯å‡ºç°äº†å„ç§ MVVM æ¡†æ¶ï¼ŒMVVM æ¡†æ¶è§£å†³äº†è§†å›¾å’ŒçŠ¶æ€çš„åŒæ­¥é—®é¢˜
3. ä¸ºäº†ç®€åŒ–è§†å›¾çš„æ“ä½œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼Œä½†æ˜¯æ¨¡æ¿å¼•æ“æ²¡æœ‰è§£å†³è·Ÿè¸ªçŠ¶æ€å˜åŒ–çš„é—®é¢˜ï¼Œäºæ˜¯Virtual DOM å‡ºç°äº†
4. Virtual DOM çš„å¥½å¤„æ˜¯å½“çŠ¶æ€æ”¹å˜æ—¶ä¸éœ€è¦ç«‹å³æ›´æ–° DOMï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ ‘æ¥æè¿°DOMï¼Œ Virtual DOM å†…éƒ¨å°†å¼„æ¸…æ¥šå¦‚ä½•æœ‰æ•ˆ(diff)çš„æ›´æ–° DOM
5. å‚è€ƒ github ä¸Š virtual-dom çš„æè¿°
   * è™šæ‹Ÿ DOM å¯ä»¥ç»´æŠ¤ç¨‹åºçš„çŠ¶æ€ï¼Œè·Ÿè¸ªä¸Šä¸€æ¬¡çš„çŠ¶æ€
   * é€šè¿‡æ¯”è¾ƒå‰åä¸¤æ¬¡çŠ¶æ€çš„å·®å¼‚æ›´æ–°çœŸå® DOM

### 3.3. <a name='DOMDOM'></a>4-4 è™šæ‹ŸDOMçš„ä½œç”¨å’Œè™šæ‹ŸDOMåº“

1. ä½œç”¨
   * ç»´æŠ¤è§†å›¾å’ŒçŠ¶æ€çš„å…³ç³»
   * å¤æ‚è§†å›¾æƒ…å†µä¸‹æå‡æ¸²æŸ“æ€§èƒ½
   * é™¤äº†æ¸²æŸ“ DOM ä»¥å¤–ï¼Œè¿˜å¯ä»¥å®ç° SSR(Nuxt.js/Next.js)ã€åŸç”Ÿåº”ç”¨ (Weex/React Native)ã€å°ç¨‹åº (mpvue/uni-app)ç­‰

2. Virtual Domåº“
   * [Snabbdom](https://github.com/snabbdom/snabbdom)
     * Vue 2.x å†…éƒ¨ä½¿ç”¨çš„ Virtual DOM å°±æ˜¯æ”¹é€ çš„ Snabbdom
     * å¤§çº¦ 200 SLOC(single line of code)
     * é€šè¿‡æ¨¡å—å¯æ‰©å±•
     * æºç ä½¿ç”¨ TypeScript å¼€å‘
     * æœ€å¿«çš„ Virtual DOM ä¹‹ä¸€
   * [virtual-dom](https://github.com/Matt-Esch/virtual-dom)

### 3.4. <a name='Snabbdom-'></a>4-5 SnabbdomåŸºæœ¬ä½¿ç”¨ - åˆ›å»ºé¡¹ç›®

1. åˆ›å»ºé¡¹ç›®
   * æ‰“åŒ…å·¥å…·ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ parcel
   * åˆ›å»ºé¡¹ç›®ï¼Œå¹¶å®‰è£… parcel

    ```python
    # åˆ›å»ºé¡¹ç›®ç›®å½•
    md snabbdom-demo
    # è¿›å…¥é¡¹ç›®ç›®å½•
    cd snabbdom-demo
    # åˆ›å»º package.json yarn init -y
    # æœ¬åœ°å®‰è£… parcel
    yarn add parcel-bundler
    ```

   * é…ç½® package.json çš„ scripts

    ```json
    "scripts": {
      "dev": "parcel index.html --open", 
      "build": "parcel build index.html"
    }
    ```

   * åˆ›å»ºç›®å½•ç»“æ„

    ```json
    â”‚ index.html 
    â”‚ package.json 
    â””â”€src
        01-basicusage.js  
    ```

### 3.5. <a name='Snabbdom'></a>4-6 å¯¼å…¥ Snabbdom
